var base={name:"Barcelona",lat:41.3907242,lon:2.1773645,info:"Barcelona is a nice place!",wiki:"barcelona",foursquare:"barcelona2"},bcnArr=[{name:"Sagrada Familia",lat:41.403123,lon:2.173728,info:"A must see! This is Gaudi's enduring legacy, still under construction.",wiki:"sagrada familia"},{name:"Parc Güell",lat:41.41361,lon:2.153136,info:"An amazing place to walk around, mystical, and, unless things have changed, free to the public!",wiki:"parc güell"},{name:"L'Ovella Negra",lat:41.3831457,lon:2.1682898,info:"This is the best place to get sangria in... all Spain!",wiki:"el raval"},{name:"Bon Mercat Roasters",lat:41.3835709,lon:2.1777242,info:"This is the best coffee and drinking chocolate in Barcelona, and probably the world.",wiki:"gothic quarter barcelona"},{name:"La Boqueria",lat:41.3813886,lon:2.1718393,info:"This is the classic outdoor market place, fresh fruits, food stands, etc. So fun!",wiki:"la rambla barcelona"}];$("ul#bcn-list,.sliding-panel-button,.sliding-panel-fade-screen,.sliding-panel-close,.filter-list-elements").on("click",function(a){$(".sliding-panel-content,.sliding-panel-fade-screen").toggleClass("is-visible"),a.preventDefault()}),$(".accordion-tabs-minimal").each(function(a){$(this).children("li").first().children("a").addClass("is-active").next().addClass("is-open").show()}),$(".accordion-tabs-minimal").on("click","li > a.tab-link",function(a){if($(this).hasClass("is-active"))a.preventDefault();else{a.preventDefault();var b=$(this).closest(".accordion-tabs-minimal");b.find(".is-open").removeClass("is-open").hide(),$(this).next().toggleClass("is-open").toggle(),b.find(".is-active").removeClass("is-active"),$(this).addClass("is-active")}});var ViewModel=function(){function a(){map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:13,center:new google.maps.LatLng(base.lat,base.lon)});var a=new google.maps.InfoWindow({});bcnArr.forEach(function(c){var d=new google.maps.Marker({position:new google.maps.LatLng(c.lat,c.lon),map:map,title:c.name,info:c.info,wiki:c.wiki,foursquare:c.lat+","+c.lon,listClick:function(b){console.log("from the viewmodel: "+ajaxFourSquare(d.foursquare)),ajaxWiki(d.wiki),a.setContent(b.info),a.open(map,b),null==d.getAnimation()?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null)},4e3)):d.setAnimation(null)}});b.markersVisible.push(d),b.markersMap.push(d),d.addListener("click",function(){console.log("from the viewmodel: "+ajaxFourSquare(d.foursquare)),ajaxWiki(d.wiki),null==d.getAnimation()?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null)},4e3)):d.setAnimation(null),a.setContent(d.info),a.open(map,d)})})}var b=this;b.markersVisible=ko.observableArray([]),b.markersMap=ko.observableArray([]),b.infoWindows=ko.observableArray([]),b.filterList=ko.observable(""),b.foursquareContent=ko.observable("Init"),b.filterList.subscribe(function(a){b.markersMap().forEach(function(a){a.setVisible(!1),b.markersVisible.remove(a)}),b.markersMap().forEach(function(c){c.title.toLowerCase().indexOf(a.toLowerCase())>=0&&(c.setVisible(!0),b.markersVisible.push(c))})}),google.maps.event.addDomListener(window,"load",a)},base=bcnArr[0];baseLatLon={lat:base.lat,lng:base.lon};var baseLat=base.lat,baseLon=base.lon;ajaxWiki=function(a){var b=$("#wikipedia-tab"),c="https://en.wikipedia.org/w/api.php?action=opensearch&search=",d="&prop=revisions&rvprop=content&format=json&callback=?";c=c+a+d,b.children().fadeOut(1e3);var e=setTimeout(function(){b.text("Bummer! No results could be found to match that address...:-(")},5e3);$.ajax({url:c,dataType:"json"}).done(function(a){var c=a[1][0],d=a[3][0],f=a[2][0],g="<h3>"+c+"</h3><p>"+f+'</p><a href="'+d+'" target="_blank">Read more on Wikipedia...</a>';b.append(g),clearTimeout(e)}).fail(function(a){var c="<p>Bummer!... Could not load data from Wikipedia! Make sure you are connected to the Internet, or try again later.</p>";b.append(c)})},ajaxFourSquare=function(a){var b=$("#foursquare-tab"),c="2EE11MHVU5MQHXAS4YNOTYW3WO4OLJOA0DU5OKLET1VRHNXF",d="SJYX3UAEK3HNWLRPCO4CMYWAQWLYLDAYWYHSMCBDCC3WQKYT";b.children().fadeOut(1e3),$.ajax({type:"GET",dataType:"json",cache:!1,url:"https://api.foursquare.com/v2/venues/explore?",data:"limit=5&ll="+a+"&radius=5000&venuePhotos=1&client_id="+c+"&client_secret="+d+"&v=20140806&m=foursquare",async:!0}).done(function(a){for(var b=a.response.groups[0].items,c="",d=0;d<b.length;d++){var e,f,g,h,i,j=b[d];e=j.venue.name,f=j.tips[0].text?j.tips[0].text:"No tips here!",g=j.venue.photos.groups[0].items[0],h=g.prefix+"100x100"+g.suffix,i=j.tips[0].canonicalUrl,c+='<div class="foursquare-item"><img src="'+h+'" alt=""/><h3>'+e+"</h3><p>"+f+'</p><a href="'+i+'" target="_blank">Read more on FourSquare...</a></div>'}return console.log("from the ajax call: "+c),c}).fail(function(a){var c="<p>Bummer!... Could not load data from Foursquare! Make sure you are connected to the Internet, or try again later.</p>";b.append(c)})};var googleError=function(){alert("Bummer... Looks like Google Maps is not loading. Please try again later.")},googleSuccess=function(){ko.applyBindings(new ViewModel)},baseLatLon=base.lat+","+base.lon;ajaxFourSquare(baseLatLon),ajaxWiki(base.wiki);