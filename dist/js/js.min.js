var base={name:"Barcelona",lat:41.3907242,lon:2.1773645,info:"Barcelona is a nice place!",wiki:"barcelona",foursquare:"barcelona2"},bcnArr=[{name:"Sagrada Familia",lat:41.403123,lon:2.173728,info:"A must see! This is Gaudi's enduring legacy, still under construction.",wiki:"sagrada familia"},{name:"Parc Güell",lat:41.41361,lon:2.153136,info:"An amazing place to walk around, mystical, and, unless things have changed, free to the public!",wiki:"parc güell"},{name:"L'Ovella Negra",lat:41.3831457,lon:2.1682898,info:"This is the best place to get sangria in... all Spain!",wiki:"el raval"},{name:"Bon Mercat Roasters",lat:41.3835709,lon:2.1777242,info:"This is the best coffee and drinking chocolate in Barcelona, and probably the world.",wiki:"gothic quarter barcelona"},{name:"La Boqueria",lat:41.3813886,lon:2.1718393,info:"This is the classic outdoor market place, fresh fruits, food stands, etc. So fun!",wiki:"la rambla barcelona"}];$("ul#bcn-list,.sliding-panel-button,.sliding-panel-fade-screen,.sliding-panel-close,.filter-list-elements").on("click",function(a){$(".sliding-panel-content,.sliding-panel-fade-screen").toggleClass("is-visible"),a.preventDefault()}),$(".accordion-tabs-minimal").each(function(a){$(this).children("li").first().children("a").addClass("is-active").next().addClass("is-open").show()}),$(".accordion-tabs-minimal").on("click","li > a.tab-link",function(a){if($(this).hasClass("is-active"))a.preventDefault();else{a.preventDefault();var b=$(this).closest(".accordion-tabs-minimal");b.find(".is-open").removeClass("is-open").hide(),$(this).next().toggleClass("is-open").toggle(),b.find(".is-active").removeClass("is-active"),$(this).addClass("is-active")}});var ViewModel=function(){function a(){map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:13,center:new google.maps.LatLng(base.lat,base.lon)});var a=new google.maps.InfoWindow({});bcnArr.forEach(function(c){var d=new google.maps.Marker({position:new google.maps.LatLng(c.lat,c.lon),map:map,title:c.name,info:c.info,wiki:c.wiki,foursquare:c.lat+","+c.lon,listClick:function(c){b.ajaxFourSquare(d.foursquare),b.ajaxWiki(d.wiki),a.setContent(c.info),a.open(map,c),null==d.getAnimation()?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null)},4e3)):d.setAnimation(null)}});b.markersVisible.push(d),b.markersMap.push(d),d.addListener("click",function(){b.ajaxFourSquare(d.foursquare),b.ajaxWiki(d.wiki),null==d.getAnimation()?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null)},4e3)):d.setAnimation(null),a.setContent(d.info),a.open(map,d)})})}var b=this;b.markersVisible=ko.observableArray([]),b.markersMap=ko.observableArray([]),b.infoWindows=ko.observableArray([]),b.filterList=ko.observable(""),b.wikiTitle=ko.observable("Barcelona"),b.wikiContent=ko.observable("Barcelona is the capital city of the autonomous community of Catalonia in the Kingdom of Spain, as well as the country's second most populous municipality, with a population of 1.6 million within city limits..."),b.wikiLink=ko.observable("https://en.wikipedia.org/wiki/Barcelona"),b.fstitle=ko.observable("Parc de la Ciutadella"),b.fscontent=ko.observable("This chilled out park provides some welcome respite from the bustling city centre. The fountains are impressive, and it's worth renting one of the rowing boats to enjoy a relaxed afternoon..."),b.fsphotoURL=ko.observable("https://irs0.4sqi.net/img/general/100x100/56087041_V8nRYS1iIp6I3QReshg9vvvBX5TZ3kdMyQiF6VsYSe8.jpg"),b.fsurl=ko.observable("https://foursquare.com/v/parc-de-la-ciutadella/4adcda50f964a5203b4121e3"),b.ajaxWiki=function(a){var c=$("#wikipedia-tab"),d="https://en.wikipedia.org/w/api.php?action=opensearch&search=",e="&prop=revisions&rvprop=content&format=json&callback=?";d=d+a+e;var f=setTimeout(function(){c.text("Bummer! No results could be found to match that address...:-(")},5e3);$.ajax({url:d,dataType:"json"}).done(function(a){b.wikiTitle(a[1][0]),b.wikiLink(a[3][0]),b.wikiContent(a[2][0]),clearTimeout(f)}).fail(function(a){var b="<p>Bummer!... Could not load data from Wikipedia! Make sure you are connected to the Internet, or try again later.</p>";c.append(b)})},b.ajaxFourSquare=function(a){var c=$("#foursquare-tab"),d="2EE11MHVU5MQHXAS4YNOTYW3WO4OLJOA0DU5OKLET1VRHNXF",e="SJYX3UAEK3HNWLRPCO4CMYWAQWLYLDAYWYHSMCBDCC3WQKYT";$.ajax({type:"GET",dataType:"json",cache:!1,url:"https://api.foursquare.com/v2/venues/explore?",data:"limit=5&ll="+a+"&radius=5000&venuePhotos=1&client_id="+d+"&client_secret="+e+"&v=20140806&m=foursquare",async:!0}).done(function(a){for(var c=a.response.groups[0].items,d=0;d<c.length;d++){var e,f=c[d];b.fstitle(f.venue.name),b.fscontent(f.tips[0].text?f.tips[0].text:"No tips here!"),e=f.venue.photos.groups[0].items[0],b.fsphotoURL(e.prefix+"100x100"+e.suffix),b.fsurl(f.tips[0].canonicalUrl)}}).fail(function(a){var b="<p>Bummer!... Could not load data from Foursquare! Make sure you are connected to the Internet, or try again later.</p>";c.append(b)})},b.filterList.subscribe(function(a){b.markersMap().forEach(function(a){a.setVisible(!1),b.markersVisible.remove(a)}),b.markersMap().forEach(function(c){c.title.toLowerCase().indexOf(a.toLowerCase())>=0&&(c.setVisible(!0),b.markersVisible.push(c))})}),google.maps.event.addDomListener(window,"load",a)},base=bcnArr[0];baseLatLon={lat:base.lat,lng:base.lon};var baseLat=base.lat,baseLon=base.lon,googleError=function(){alert("Bummer... Looks like Google Maps is not loading. Please try again later.")},googleSuccess=function(){ko.applyBindings(new ViewModel)},baseLatLon=base.lat+","+base.lon;